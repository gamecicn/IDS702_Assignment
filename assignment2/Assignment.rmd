---
title: "Assignment 2"
author: "Maobin Guo"
output:
  pdf_document: default
  word_document: default
  html_document:
    df_print: paged
---

```{r setup, echo = FALSE, include=FALSE}

options(warn=-1)
options(xtable.comment = FALSE)


library(ggplot2)
library(xtable)
library(rms)


```


# Question1 

```{r echo = FALSE}

rm(list = ls())

df <- read.csv("OldFaithful.csv", stringsAsFactors = FALSE, sep = "," ,dec="," )
df$Duration <- as.double(df$Duration)
df$DurationCent <- df$Duration - mean(df$Duration)
```

##### 1.1 Fit a regression model for predicting the interval between eruptions from the duration of the previous one, to the data, and interpret your results.



```{r echo = FALSE}

model <- lm(Interval~DurationCent, data=df)

```
\hfill\break

**Model Result:**


```{r echo = FALSE, results='asis'}

xtable(model)

#par(mfrow=c(2,2))
#plot(model, which = 1, col=c("blue4"))
#plot(model, which = 2, col=c("blue4"))
#plot(model, which = 3, col=c("blue4"))
#plot(model, which = 5, col=c("blue4"))

```

**Interpret:**
According to the observing data, the average interval between eruptions is 71 minutes. Every minute change of erupting duration before the gap will change the interval in the same direction by 10.7 minutes. 


##### 1.2 Include the 95% confidence interval for the slope, and explain what the interval reveals about the relationship between duration and waiting time.

\hfill\break

**95% Confidence Interval:**

```{r echo = FALSE, results='asis'}

xtable(confint(model))

```

\hfill\break

**Interpret:**

The 95% confidence interval for DurationCent (Centered duration) to predict the interval between two eruptions is (9.49, 11.98) minutes. Because 0 does not appear in the interval, there is enough evidence to say a relationship between duration and interval. 


##### 1.3 Describe in a few sentences whether or not you think the regression assumptions are plausible based on residual plots (do not include any plots).

\hfill\break

**Description:**

From the residual plot, there is no evidence that the regression assumptions were broke. 
- There is no apparent trend in the residual scatter plot. 
- The distribution of residuals is interdependent in the observations.
- The distribution of residuals is very like a normal distribution. 

\hfill\break

##### 1.4 Fit another regression model for predicting interval from duration and day. Treat day as a categorical/factor variable. Is there a significant difference in mean intervals for any of the days (compared to the first day)? Interpret the effects of controlling for the days (do so only for the days with significant effects, if any).

```{r echo = FALSE, results='asis'}
df$Date <- as.factor(df$Date)

model_withday <- lm(Interval~DurationCent+Date, data=df)

```
\hfill\break

There is no significant difference in mean intervals for any of the days. Because:
- p-value of each day is >> 0.05 
- The confidence interval of each day's slope contains 0. 

Days is an invalid factor to predict intervals with duration.


##### 1.5 Perform an F-test to compare this model to the previous model excluding day. In context of the question, what can you conclude from the results of the F-test?

\hfill\break
**Result:**
```{r echo = FALSE, results='asis'}

ftest_result <- anova(model, model_withday)

xtable(ftest_result)
```
 
\hfill\break
**Interpret:**

According to the F-test, the p-value is 0.98, which means we cannot refuse the hypothesis that the two models are equal to predict interval. We can also conclude that there is no interaction between days and duration. 


##### 1.6 Using k-fold cross validation (with k=10), compare the average RMSE for this model and the average RMSE for the previous model excluding day. Which model appears to have higher predictive accuracy based on the average RMSE values?
 
```{r echo = FALSE, results='asis'}

set.seed(123) # use whatever number you want

new_df <- df[sample(nrow(df)),]
# Define the number of folds you want
K <- 10
# Define a matrix to save your results into
RSME <- matrix(0,nrow=K,ncol=1)
# Split the row indexes into k equal parts
kth_fold <- cut(seq(1,nrow(df)),breaks=K,labels=FALSE)
# Now write the for loop for the k-fold cross validation


for(k in 1:K){
  # Split your data into the training and test datasets
  test_index <- which(kth_fold==k)
  train <- df[-test_index,]
  test <- df[test_index,]
  
  y_test_pred <- predict(model_withday, test)
  testMSE <- mean((df$Interval- y_test_pred)^2);
  # Now that you've split the data, 
  RSME[k,] <- sqrt(testMSE)
}

RSME_withday = mean(RSME)


for(k in 1:K){
  # Split your data into the training and test datasets
  test_index <- which(kth_fold==k)
  train <- df[-test_index,]
  test <- df[test_index,]
  
  y_test_pred <- predict(model, test)
  testMSE <- mean((df$Interval- y_test_pred)^2);
  # Now that you've split the data, 
  RSME[k,] <- sqrt(testMSE)
}

RSME_normal = mean(RSME)
#RSME_withday
```
\hfill\break
**Interpret:**

Model without days has higher predictive accuracy based on the average RMSE.   

\newpage


#         MATERNAL SMOKING AND BIRTH WEIGHTS

 
```{r echo = FALSE}

rm(list = ls())

df <- read.csv("smoking.csv", stringsAsFactors = FALSE, sep = "," ,dec="," )

#Remove gestation
df = subset(df, select = -c(date, gestation))

# collapse race categories from 0 - 5 into one category for race = white
df[df$mrace < 6, ]$mrace = 5
df[df$med <= 7 & df$med >= 6, ]$med = 7


# Factorize 
df$med   <- as.factor(df$med)
df$mrace <- as.factor(df$mrace)
df$smoke <- as.factor(df$smoke)

df$parityCent <- df$parity - mean(df$parity)
df$mageCent <- df$mage - mean(df$mage)
df$mhtCent <- df$mht - mean(df$mht)
df$mpregwtCent <- df$mpregwt - mean(df$mpregwt)


```



```{r echo = FALSE, include=FALSE}

hist(df$bwt.oz)
# Conclude:  df$bwt.oz is normal distribution 


hist(df$parity)
#df$parity_log <- log(df$parity)
#hist(df$parity_log)

hist(df$mage)
df$mage_log <- log(df$mage)
hist(df$mage_log)

hist(df$mht)
hist(df$mpregwt)
hist(df$inc)

```

```{r echo = FALSE, include=FALSE}

# Plot 

plot(y = df$bwt.oz, x = df$parity) 
plot(y = df$bwt.oz, x = df$mage_log) 
plot(y = df$bwt.oz, x = df$mht) 
plot(y = df$bwt.oz, x = df$mpregwt) 
plot(y = df$bwt.oz, x = df$inc) 

# Terriable no linear relation ship

```  


```{r echo = FALSE, include=FALSE}

boxplot(bwt.oz~smoke,  data=df)
boxplot(bwt.oz~med,  data=df)
boxplot(bwt.oz~mrace,  data=df)

```



```{r echo = FALSE, include=FALSE}

ggplot(df,aes(x=parity, y=bwt.oz)) +
  geom_point(alpha = .5,colour="blue4") +
  geom_smooth(method="lm",col="red3") + theme_classic() +
  facet_wrap( ~ med) 

```

```{r echo = FALSE, include=FALSE}

ggplot(df,aes(x=parity, y=bwt.oz)) +
  geom_point(alpha = .5,colour="blue4") +
  geom_smooth(method="lm",col="red3") + theme_classic() +
  facet_wrap( ~ mrace) 

```

```{r echo = FALSE, include=FALSE}

ggplot(df,aes(x=parity, y=bwt.oz)) +
  geom_point(alpha = .5,colour="blue4") +
  geom_smooth(method="lm",col="red3") + theme_classic() +
  facet_wrap( ~ smoke) 

```


```{r echo = FALSE, include=FALSE}

ggplot(df,aes(x=mage, y=bwt.oz)) +
  geom_point(alpha = .5,colour="blue4") +
  geom_smooth(method="lm",col="red3") + theme_classic() +
  facet_wrap( ~ med) 

```

```{r echo = FALSE, include=FALSE}

ggplot(df,aes(x=mht, y=bwt.oz)) +
  geom_point(alpha = .5,colour="blue4") +
  geom_smooth(method="lm",col="red3") + theme_classic() +
  facet_wrap( ~ med) 

```


```{r echo = FALSE, include=FALSE}

ggplot(df,aes(x=mpregwt, y=bwt.oz)) +
  geom_point(alpha = .5,colour="blue4") +
  geom_smooth(method="lm",col="red3") + theme_classic() +
  facet_wrap( ~ med) 

```

```{r echo = FALSE, include=FALSE}

ggplot(df,aes(x=inc, y=bwt.oz)) +
  geom_point(alpha = .5,colour="blue4") +
  geom_smooth(method="lm",col="red3") + theme_classic() +
  facet_wrap( ~ med) 

```


```{r echo = FALSE, include=FALSE}

ggplot(df,aes(x=inc, y=bwt.oz)) +
  geom_point(alpha = .5,colour="blue4") +
  geom_smooth(method="lm",col="red3") + theme_classic() +
  facet_wrap( ~ mrace) 

```

```{r echo = FALSE, include=FALSE}

ggplot(df,aes(x=parity, y=bwt.oz)) +
  geom_point(alpha = .5,colour="blue4") +
  geom_smooth(method="lm",col="red3") + theme_classic() +
  facet_wrap( ~ mrace) 

```

```{r echo = FALSE, include=FALSE}

ggplot(df,aes(x=mht, y=bwt.oz)) +
  geom_point(alpha = .5,colour="blue4") +
  geom_smooth(method="lm",col="red3") + theme_classic() +
  facet_wrap( ~ mrace) 

```

```{r echo = FALSE, include=FALSE}

ggplot(df,aes(x=mpregwt, y=bwt.oz)) +
  geom_point(alpha = .5,colour="blue4") +
  geom_smooth(method="lm",col="red3") + theme_classic() +
  facet_wrap( ~ mrace) 

```



```{r echo = FALSE, include=FALSE}

# 
raw_model_1 <- lm(bwt.oz ~ parity + mrace + mage_log + med + mht + mpregwt + inc + smoke, data=df)

raw_model_1 <- lm(bwt.oz ~ parity + mrace + mage_log + mht + mpregwt + inc + smoke, data=df)


raw_model_2 <- lm(bwt.oz ~ parity + mrace*mht + mage_log + mpregwt  + smoke, data=df)

raw_model_3 <- lm(bwt.oz ~ parity + smoke  + mage_log + mpregwt  + mht, data=df)

```

```{r echo = FALSE, include=FALSE}

#model_null <- lm(bwt.oz~1,data=df)
#raw_full <- lm(bwt.oz ~ parity + mrace + mage_log + med + mht + mpregwt + inc + smoke, data=df)
#
#Model_forward_aic <- step(model_null, scope = formula(raw_full),direction="forward",trace=0)
#
#Model_forward_bic <- step(model_null, scope = formula(raw_full),direction="forward",trace=0, k = #log(n))
#
#
#Model_back_aic <- step(raw_full, direction="backward",trace=0)
#
#Model_back_bic <- step(raw_full, direction="backward",trace=0, k = log(n))
#
#Model_both_aic <- step(model_null, scope = formula(raw_full),direction="both",trace=0)
#
#Model_both_bic <- step(model_null, scope = formula(raw_full),direction="both",trace=0, k = #log(n))

final_model = lm(formula = bwt.oz ~ smoke + mht + mrace + mpregwt + parity, data = df)

# TO Answer :2
#What is a likely range for the difference in birth weights for smokers and non-smokers?
# confint(final_model) 

# TO Answer :3
#
#Is there any evidence that the association between smoking and birth weight differs by motherâ€™s #race? If so, characterize those differences.

ggplot(df,aes(x=smoke, y=bwt.oz, fill=smoke)) +
  geom_boxplot()  +
  scale_fill_brewer(palette="Blues") +
  theme_classic() + theme(legend.position="none") +
  facet_wrap( ~ mrace)

```



## Summary

A linear regression model was built to query the relationship between maternal smoking and the baby's birth weight IN this investigation. The model indicates a strong relationship between maternal smoking with a baby's birth weight. By controlling other factors, the mother's smoke would decrease the baby's birth weight by 9.35 oz on average.


## Introduction




## Data


## Model


## Conclusion












